# TODO list – BabelStream-Android

更新时间：2025-10-28

## 现状概览
- 启动入口：MainActivity（新增“设置”按钮）。
- 设置页：新增“音频输入源（系统音频/麦克风）”，应用深色主题覆盖；进入设置时自动隐藏悬浮窗，离开时恢复。
- 悬浮窗：支持样式调整、双行显示；新增广播可隐藏/显示。
- 识别服务：支持两条采集路径（PlaybackCapture/AudioRecord），按输入源自动选择；加入音频电平广播；前台服务类型在 Android 14+ 兼容修复。
- 主界面：新增音频电平条；字幕区与按钮的深色对比度优化。

## 待验证/排查
1. 系统音频捕获在目标 App 上的可用性
   - 目标：B站/本地播放器应有电平与字幕；YouTube 可能被系统静音（预期行为）。
   - 若系统音频无电平但麦克风有，视为平台限制而非Bug。

2. 麦克风模式“屡次停止”问题回归验证
   - 已在 Manifest 声明 microphone 前台类型，并在代码按输入源选择类型，加入回退。
   - 观察是否仍出现“屡次停止”；若出现，请抓取 Logcat（E/AndroidRuntime 第一条）。

3. 字体/控件仍为黑色的个别点
   - 若还有黑字，请截点位（控件/区域），补 textColor 或样式覆盖。

## 下一步计划（建议）
1. 状态栏文案增强
   - 当电平长期接近 0（>3s）时，显示“捕获到静音，可能被目标应用禁用录制”。

2. 启动行为开关
   - 在设置中增加：“启动应用后自动开始识别并开启悬浮窗”。

3. README 更新
   - 新增“输入源选择/权限说明/电平指示与排错”章节。

4. 依赖核对
   - 按阿里云官方文档替换为实时语音/翻译 Java SDK 的正确坐标（当前仅通用 dashscope 依赖）。

## 快速操作清单
- 系统音频识别：设置 → 音频输入源选“系统音频(推荐)” → 主界面“开始” → 观察电平和字幕。
- 麦克风识别：设置 → 选“麦克风” → 授权麦克风 → 主界面“开始”。
- 悬浮窗：主界面“开启悬浮窗”或设置页“开始悬浮字幕识别”。

## 近期修改记录（摘要）
- Manifest：修正前台服务类型，新增 MICROPHONE 权限。
- RecognitionService：按源选择前台类型；电平广播；稳定性回退。
- PlaybackCaptureManager/AudioCaptureManager：与识别器串联发送数据。
- MainActivity：新增电平条与设置入口；UI对比度调整。
- SettingsActivity：音源选择；隐藏/显示悬浮窗；去除自动最小化。
- OverlayService：新增隐藏/显示广播；样式应用。
- 主题与布局：深色主题覆盖，Spinner 自定义项，避免黑字。

